<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Remote TV - Live</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --accent: #00f2fe; }
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; overflow: hidden; }

        /* ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ */
        #videoContainer { width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; z-index: 1; }
        video { width: 100%; height: 100%; object-fit: contain; }

        /* ‡¶∞‡¶ø‡¶Æ‡ßã‡¶ü ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶¨‡¶ï‡ßç‡¶∏ (‡¶ü‡¶ø‡¶≠‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø) */
        .tv-overlay {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.8); padding: 15px; border-radius: 15px;
            border: 1px solid var(--accent); text-align: center;
            backdrop-filter: blur(10px); transition: opacity 0.5s;
        }
        .qr-box img { width: 110px; height: 110px; background: #fff; border-radius: 5px; padding: 5px; }
        .tv-id { font-size: 16px; color: var(--accent); font-weight: bold; margin-top: 5px; }

        /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∞‡¶ø‡¶Æ‡ßã‡¶ü ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶´‡ßá‡¶∏ (‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá) */
        #mobileRemote {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 999; padding: 20px; box-sizing: border-box; text-align: center;
        }
        .remote-btn {
            width: 80%; padding: 20px; margin: 15px auto; font-size: 20px;
            background: var(--accent); border: none; border-radius: 15px;
            color: #000; font-weight: bold; cursor: pointer;
        }
        .remote-btn:active { transform: scale(0.95); opacity: 0.8; }

        /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ü‡ßç‡¶∞‡ßá */
        .bottom-ui {
            position: fixed; bottom: 0; width: 100%; z-index: 50;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 20px; transition: 0.5s;
        }
        #playingNow { margin-left: 20px; font-size: 1.2rem; color: var(--accent); }
    </style>
</head>
<body>

    <div id="videoContainer">
        <video id="mainPlayer" autoplay muted playsinline controls></video>
    </div>

    <div class="tv-overlay" id="tvOverlay">
        <div class="qr-box"><img id="qrImg" src="" alt="QR"></div>
        <div class="tv-id" id="displayID">ID: ...</div>
        <p style="font-size: 10px; margin: 5px 0 0;">‡¶∞‡¶ø‡¶Æ‡ßã‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
    </div>

    <div class="bottom-ui" id="bottomUI">
        <p id="playingNow">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</p>
    </div>

    <div id="mobileRemote">
        <h2 style="color: var(--accent);">BD TV REMOTE</h2>
        <hr border="1" color="#333">
        <div style="margin-top: 50px;">
            <button class="remote-btn" onclick="sendCmd('prev')">‚óÄ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</button>
            <button class="remote-btn" onclick="sendCmd('next')">‡¶™‡¶∞‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‚ñ∂</button>
            <button class="remote-btn" style="background:#ff4444; color:#fff" onclick="sendCmd('reload')">üîÑ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ü‡¶ø‡¶≠‡¶ø</button>
        </div>
        <p style="margin-top: 30px; color: #666;">‡¶ü‡¶ø‡¶≠‡¶ø‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§</p>
    </div>

<script>
    // ‡ßß. Firebase Setup (‡¶´‡ßç‡¶∞‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶¨‡ßç‡¶∞‡¶ø‡¶ú)
    const firebaseConfig = { databaseURL: "https://tv-remote-demo-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const m3uUrl = "https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv/refs/heads/main/Live%20tv";
    const video = document.getElementById('mainPlayer');
    let channels = [];
    let currentIdx = 0;
    let hls = null;

    // ‡ß®. ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶∂‡¶®‡¶æ‡¶ï‡ßç‡¶§‡¶ï‡¶∞‡¶£ (TV or Mobile)
    const urlParams = new URLSearchParams(window.location.search);
    const connectID = urlParams.get('remoteId');

    async function init() {
        // M3U ‡¶´‡ßá‡¶ö ‡¶ï‡¶∞‡¶æ
        const res = await fetch(m3uUrl);
        const data = await res.text();
        const lines = data.split('\n');
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].includes('#EXTINF')) {
                channels.push({ name: lines[i].split(',')[1].trim(), url: lines[i+1].trim() });
            }
        }

        if (connectID) {
            setupMobileRemote();
        } else {
            setupTV();
        }
    }

    // ‡ß©. ‡¶ü‡¶ø‡¶≠‡¶ø ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
    function setupTV() {
        const tvID = localStorage.getItem('tv_id') || Math.floor(1000 + Math.random() * 9000);
        localStorage.setItem('tv_id', tvID);
        document.getElementById('displayID').innerText = "ID: " + tvID;

        // QR Code ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶∂‡¶®
        const remoteLink = window.location.href.split('?')[0] + "?remoteId=" + tvID;
        document.getElementById('qrImg').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(remoteLink)}`;

        // ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶∂‡ßã‡¶®‡¶æ
        db.ref('remotes/' + tvID).on('value', (snap) => {
            const cmd = snap.val();
            if (cmd === 'next') changeChannel(1);
            if (cmd === 'prev') changeChannel(-1);
            if (cmd === 'reload') location.reload();
            db.ref('remotes/' + tvID).set(null); // ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶Æ‡ßÅ‡¶õ‡¶æ
        });

        play(0);
    }

    // ‡ß™. ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∞‡¶ø‡¶Æ‡ßã‡¶ü ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
    function setupMobileRemote() {
        document.getElementById('mobileRemote').style.display = 'block';
        document.getElementById('videoContainer').style.display = 'none';
        document.getElementById('tvOverlay').style.display = 'none';
        document.getElementById('bottomUI').style.display = 'none';
    }

    function sendCmd(cmd) {
        db.ref('remotes/' + connectID).set(cmd);
    }

    // ‡ß´. ‡¶™‡ßç‡¶≤‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
    function play(index) {
        currentIdx = index;
        const ch = channels[currentIdx];
        document.getElementById('playingNow').innerText = "‡¶è‡¶ñ‡¶® ‡¶ö‡¶≤‡¶õ‡ßá: " + ch.name;

        if (hls) hls.destroy();
        if (Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(ch.url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else {
            video.src = ch.url;
        }
        showUI();
    }

    function changeChannel(dir) {
        let newIdx = (currentIdx + dir + channels.length) % channels.length;
        play(newIdx);
    }

    function showUI() {
        document.getElementById('tvOverlay').style.opacity = "1";
        document.getElementById('bottomUI').style.opacity = "1";
        clearTimeout(window.hideT);
        window.hideT = setTimeout(() => {
            document.getElementById('tvOverlay').style.opacity = "0.2";
            document.getElementById('bottomUI').style.opacity = "0";
        }, 5000);
    }

    init();
</script>
</body>
</html>
