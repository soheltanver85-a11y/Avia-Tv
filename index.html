<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BD LIVE TV - Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.12"></script>
    <style>
        :root { --accent: #00f2fe; --bg: #000; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; margin: 0; overflow: hidden; }

        /* ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞ */
        #videoContainer { width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; z-index: 1; background: #000; }
        video { width: 100%; height: 100%; object-fit: contain; }

        /* ‡¶∏‡¶æ‡¶á‡¶° ‡¶ü‡ßÅ‡¶≤‡¶¨‡¶æ‡¶∞ */
        .side-toolbar {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            display: flex; flex-direction: column; gap: 15px; align-items: flex-end;
            transition: opacity 0.5s;
        }

        .tool-item {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px;
            padding: 10px; cursor: pointer; transition: 0.3s; color: #fff;
            display: flex; align-items: center; gap: 10px; text-decoration: none; outline: none;
        }

        .tool-item:focus { background: var(--accent); color: #000; transform: scale(1.1); }

        /* ‡¶ï‡¶ø‡¶â‡¶Ü‡¶∞ ‡¶ï‡ßã‡¶° */
        .qr-section img { width: 40px; border-radius: 5px; border: 2px solid #fff; }
        .tool-item:focus img { width: 150px; }

        /* ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü */
        .bottom-overlay {
            position: fixed; bottom: 0; width: 100%; z-index: 50;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 20px; transition: opacity 0.5s;
        }

        .channel-tray { display: flex; gap: 15px; overflow-x: auto; padding: 10px; scroll-behavior: smooth; }
        .channel-tray::-webkit-scrollbar { display: none; }

        .tv-card {
            min-width: 160px; height: 90px; background: rgba(255,255,255,0.1);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; border: 3px solid transparent; outline: none;
            font-weight: bold; text-align: center; padding: 5px;
        }
        .tv-card:focus { border-color: var(--accent); transform: scale(1.1); background: rgba(0, 242, 254, 0.3); }

        .status-msg { position: fixed; top: 20px; left: 20px; z-index: 100; color: var(--accent); font-size: 14px; }
    </style>
</head>
<body>

    <div class="status-msg" id="status">‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>

    <div id="videoContainer">
        <video id="mainPlayer" controls autoplay muted playsinline></video>
    </div>

    <div class="side-toolbar" id="sideToolbar">
        <button class="tool-item" onclick="location.reload()">üîÑ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂</button>
        <button class="tool-item" onclick="setTimer()">‚è∞ ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞</button>
        <div class="tool-item qr-section" tabindex="0">
            <span>üì± ‡¶∞‡¶ø‡¶Æ‡ßã‡¶ü</span>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://soheltanver85-a11y.github.io/BD-LIVE-TV/" alt="QR">
        </div>
    </div>

    <div class="bottom-overlay" id="bottomUI">
        <div id="playingNow" style="margin-left: 20px; font-size: 1.1rem; margin-bottom: 10px; color: var(--accent);">‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        <div class="channel-tray" id="tray"></div>
    </div>

<script>
    const m3uUrl = "https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv/refs/heads/main/Live%20tv";
    const video = document.getElementById('mainPlayer');
    const tray = document.getElementById('tray');
    let hls = null;
    let uiTimer;

    // ‡¶á‡¶â‡¶Ü‡¶á ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤
    function showUI() {
        document.getElementById('sideToolbar').style.opacity = '1';
        document.getElementById('bottomUI').style.opacity = '1';
        clearTimeout(uiTimer);
        uiTimer = setTimeout(() => {
            if (document.activeElement.tagName !== 'BUTTON' && !document.activeElement.classList.contains('tv-card')) {
                document.getElementById('sideToolbar').style.opacity = '0.3';
                document.getElementById('bottomUI').style.opacity = '0';
            }
        }, 7000);
    }

    document.addEventListener('mousemove', showUI);
    document.addEventListener('keydown', showUI);

    async function init() {
        try {
            const res = await fetch(m3uUrl);
            const data = await res.text();
            const lines = data.split('\n');
            const channels = [];
            
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes('#EXTINF')) {
                    const name = lines[i].split(',')[1] || "Unknown Channel";
                    const url = lines[i+1] ? lines[i+1].trim() : "";
                    if(url) channels.push({ name, url });
                }
            }
            
            render(channels);
            document.getElementById('status').innerText = "‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®";
        } catch (err) {
            document.getElementById('status').innerText = "‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡ßü‡ßá‡¶õ‡ßá!";
        }
    }

    function render(channels) {
        tray.innerHTML = '';
        channels.forEach((ch, i) => {
            const card = document.createElement('div');
            card.className = 'tv-card';
            card.tabIndex = 0;
            card.innerText = ch.name;
            card.onclick = () => play(ch.url, ch.name);
            // ‡¶è‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶ø ‡¶ö‡¶æ‡¶™‡¶≤‡ßá ‡¶™‡ßç‡¶≤‡ßá ‡¶π‡¶¨‡ßá (‡¶ü‡¶ø‡¶≠‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
            card.onkeydown = (e) => { if(e.key === 'Enter') play(ch.url, ch.name); };
            tray.appendChild(card);
        });

        if(channels.length > 0) {
            play(channels[0].url, channels[0].name);
            // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡¶ü‡¶ø ‡¶´‡ßã‡¶ï‡¶æ‡¶∏ ‡¶ï‡¶∞‡ßã ‡¶Ø‡ßá‡¶® ‡¶∞‡¶ø‡¶Æ‡ßã‡¶ü ‡¶¶‡¶ø‡ßü‡ßá ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡ßü
            setTimeout(() => tray.firstChild.focus(), 1000);
        }
    }

    function play(url, name) {
        document.getElementById('playingNow').innerText = "‡¶è‡¶ñ‡¶® ‡¶ö‡¶≤‡¶õ‡ßá: " + name;
        
        // ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶∏‡ßã‡¶∞‡ßç‡¶∏ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã
        if (hls) {
            hls.destroy();
        }

        if (Hls.isSupported()) {
            hls = new Hls({
                capLevelToPlayerSize: true,
                autoStartLoad: true
            });
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                video.play().catch(() => {
                    console.log("Auto-play blocked, waiting for user interaction");
                });
            });
            
            // ‡¶è‡¶∞‡¶∞ ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç
            hls.on(Hls.Events.ERROR, function (event, data) {
                if (data.fatal) {
                    document.getElementById('status').innerText = "‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡ßá ‡¶®‡¶æ!";
                }
            });

        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            // ‡¶∏‡¶æ‡¶´‡¶æ‡¶∞‡ßÄ ‡¶¨‡¶æ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ü‡¶ø‡¶≠‡¶ø‡¶∞ ‡¶®‡ßá‡¶ü‡¶ø‡¶≠ ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
            video.src = url;
            video.addEventListener('loadedmetadata', function() {
                video.play();
            });
        }
    }

    function setTimer() {
        const mins = prompt("‡¶ï‡¶§ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶¨‡ßá?", "30");
        if(mins) {
            alert(mins + " ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶¨‡ßá‡•§");
            setTimeout(() => { 
                video.pause();
                document.body.innerHTML = "<h1 style='color:white; text-align:center; margin-top:20%;'>TV Sleeping...</h1>"; 
            }, mins * 60000);
        }
    }

    init();
</script>
</body>
</html>
