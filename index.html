<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>BD LIVE TV</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#111; color:#fff; }
    header { background:#222; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:20px; color:#0ff; }
    #player { width:100%; height:220px; background:black; }
    video { width:100%; height:100%; object-fit:contain; }
    #matchInfo { margin:10px; }
    .live-banner { background:#ff4081; color:#fff; padding:6px 12px; border-radius:6px; text-align:center; font-weight:bold; }
    #searchBar { padding:10px; border:none; width:90%; margin:10px auto; border-radius:5px; display:block; font-size:14px; }
    #categories { display:flex; gap:10px; overflow-x:auto; padding:10px; background:#1a1a1a; }
    .cat { padding:6px 12px; background:#333; border-radius:6px; cursor:pointer; }
    .cat.active { background:#ff4081; }
    #channelList { display:flex; flex-wrap:wrap; gap:12px; padding:10px; }
    .channel-card { width:160px; background:#222; border-radius:8px; padding:10px; text-align:center; }
    .preview { width:100%; height:100px; object-fit:cover; border-radius:6px; margin-bottom:6px; background:#000; }
    .channel-name { font-size:14px; margin-bottom:6px; }
    .watchBtn, .favBtn { background:#444; border:none; padding:6px 10px; border-radius:5px; color:#fff; cursor:pointer; margin:3px; font-size:12px; }
    .watchBtn { background:#ff4081; }
  </style>
</head>
<body>
  <header>
    <h1>üì∫ BD LIVE TV</h1>
    <span id="channelCount"></span>
  </header>

  <div id="player">
    <video id="video" controls autoplay></video>
  </div>

  <div id="matchInfo"></div>

  <input type="text" id="searchBar" placeholder="‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
  <div id="categories"></div>
  <div id="channelList"></div>

<script>
const playlistUrl="https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv/refs/heads/main/Live%20tv";
let channels=[],currentIndex=0,favorites=JSON.parse(localStorage.getItem("favorites")||"[]");

async function loadPlaylist(){
  const res=await fetch(playlistUrl); const text=await res.text();
  const lines=text.split("\n"); let list=[],currentName="",currentGroup="",currentLogo="";
  for(let line of lines){
    if(line.startsWith("#EXTINF")){
      let parts=line.split(",");
      currentName=parts[1];
      let groupMatch=line.match(/group-title="([^"]+)"/);
      currentGroup=groupMatch?groupMatch[1]:"Others";
      let logoMatch=line.match(/tvg-logo="([^"]+)"/);
      currentLogo=logoMatch?logoMatch[1]:"default.png";
    } else if(line.startsWith("http")){
      list.push({ name: currentName, url: line, group: currentGroup, logo: currentLogo });
    }
  }
  return list;
}

function playChannel(url,name){
  const video=document.getElementById("video");
  if(Hls.isSupported()){ const hls=new Hls(); hls.loadSource(url); hls.attachMedia(video); }
  else if(video.canPlayType("application/vnd.apple.mpegurl")){ video.src=url; }
  showLiveMatch(name);
}

async function showLiveMatch(channelName){
  try{
    const res=await fetch("matches.json?_=" + Date.now()); // cache busting
    const matches=await res.json();
    const match=matches.find(m=>m.channel===channelName && m.status==="Live");
    const infoDiv=document.getElementById("matchInfo");

    if(match){
      infoDiv.innerHTML=`<div class="live-banner">
        üèè ${match.league}: ${match.team1} vs ${match.team2} ‚Äî ${match.status}<br>
        <strong>${match.score.team1}</strong> | <strong>${match.score.team2}</strong>
      </div>`;
    } else { infoDiv.innerHTML=""; }
  }catch(e){ console.log("No matches.json found"); }
}

function renderCategories(groups){
  const catDiv=document.getElementById("categories"); catDiv.innerHTML="";
  ["All","Favorites",...groups].forEach(g=>{
    const btn=document.createElement("div"); btn.className="cat"; btn.textContent=g;
    btn.onclick=()=>filterByGroup(g);
    catDiv.appendChild(btn);
  });
}

function renderChannels(list){
  const grid=document.getElementById("channelList"); grid.innerHTML="";
  list.forEach((ch,i)=>{
    const card=document.createElement("div"); card.className="channel-card";
    const isFav=favorites.includes(ch.name);
    card.innerHTML=`
      <video class="preview" poster="${ch.logo}" muted playsinline></video>
      <div class="channel-name">${ch.name}</div>
      <button class="watchBtn">Watch Now</button>
      <button class="favBtn">${isFav?"‚òÖ Remove":"‚òÜ Favorite"}</button>`;
    
    card.querySelector(".watchBtn").onclick=()=>{currentIndex=i;playChannel(ch.url,ch.name);};
    card.querySelector(".favBtn").onclick=()=>{
      if(favorites.includes(ch.name)){ favorites=favorites.filter(f=>f!==ch.name); }
      else { favorites.push(ch.name); }
      localStorage.setItem("favorites",JSON.stringify(favorites));
      renderChannels(list);
    };

    // Lazy Loading preview
    const observer=new IntersectionObserver(entries=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          const preview=card.querySelector(".preview");
          preview.src=ch.url;
          preview.autoplay=true; preview.loop=true;
          observer.unobserve(card);
        }
      });
    });
    observer.observe(card);

    // Fallback thumbnail
    const preview=card.querySelector(".preview");
    preview.onerror=()=>{ preview.replaceWith(`<img src="${ch.logo}" class="preview">`); };

    grid.appendChild(card);
  });
  document.getElementById("channelCount").textContent=list.length+" CHANNELS";
}

function filterByGroup(group){
  document.querySelectorAll(".cat").forEach(c=>c.classList.remove("active"));
  [...document.querySelectorAll(".cat")].find(c=>c.textContent===group).classList.add("active");
  if(group==="All"){ renderChannels(channels); }
  else if(group==="Favorites"){ renderChannels(channels.filter(ch=>favorites.includes(ch.name))); }
  else { renderChannels(channels.filter(ch=>ch.group===group)); }
}

document.getElementById("searchBar").addEventListener("input",(e)=>{
  const term=e.target.value.toLowerCase();
  const filtered=channels.filter(ch=>ch.name.toLowerCase().includes(term));
  renderChannels(filtered);
});

// ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶á‡¶®‡¶´‡ßã ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá
setInterval(()=>{
  if(channels.length>0){
    const currentChannel = channels[currentIndex];
    showLiveMatch(currentChannel.name);
  }
}, 5000);

async function init(){
  channels=await loadPlaylist(); 
  renderChannels(channels);
  const groups=[...new Set(channels.map(ch=>ch.group))];
  renderCategories(groups);
  if(channels.length>0){ playChannel(channels[0].url,channels[0].name); }
}
init();
</script>
</body>
</html>
