<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Live TV Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#111; color:#fff; }
    header { background:#222; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:20px; color:#0ff; }
    #player { width:100%; height:220px; background:black; }
    video { width:100%; height:100%; object-fit:contain; }
    #channelList { display:flex; flex-wrap:wrap; gap:12px; padding:10px; }
    .channel-card { width:160px; background:#222; border-radius:8px; padding:10px; text-align:center; }
    .preview { width:100%; height:100px; object-fit:cover; border-radius:6px; margin-bottom:6px; background:#000; }
    .channel-name { font-size:14px; margin-bottom:6px; }
    .watchBtn { background:#ff4081; border:none; padding:6px 10px; border-radius:5px; color:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ“º Live TV Pro</h1>
    <span id="channelCount"></span>
  </header>

  <div id="player">
    <video id="video" controls autoplay></video>
  </div>

  <div id="channelList"></div>

<script>
const playlistUrl="https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv/refs/heads/main/Live%20tv";
let channels=[],currentIndex=0;

async function loadPlaylist(){
  const res=await fetch(playlistUrl); const text=await res.text();
  const lines=text.split("\n"); let list=[],currentName="",currentGroup="",currentLogo="";
  for(let line of lines){
    if(line.startsWith("#EXTINF")){
      let parts=line.split(",");
      currentName=parts[1];
      let groupMatch=line.match(/group-title="([^"]+)"/);
      currentGroup=groupMatch?groupMatch[1]:"Others";
      let logoMatch=line.match(/tvg-logo="([^"]+)"/);
      currentLogo=logoMatch?logoMatch[1]:"default.png";
    } else if(line.startsWith("http")){
      list.push({ name: currentName, url: line, group: currentGroup, logo: currentLogo });
    }
  }
  return list;
}

function playChannel(url,name){
  const video=document.getElementById("video");
  if(Hls.isSupported()){ const hls=new Hls(); hls.loadSource(url); hls.attachMedia(video); }
  else if(video.canPlayType("application/vnd.apple.mpegurl")){ video.src=url; }
}

function renderChannels(list){
  const grid=document.getElementById("channelList"); grid.innerHTML="";
  list.forEach((ch,i)=>{
    const card=document.createElement("div"); card.className="channel-card";
    card.innerHTML=`
      <video class="preview" poster="${ch.logo}" muted playsinline></video>
      <div class="channel-name">${ch.name}</div>
      <button class="watchBtn">Watch Now</button>`;
    
    // Watch Now â†’ à¦®à§‚à¦² à¦ªà§à¦²à§‡à¦¯à¦¼à¦¾à¦°à§‡ à¦šà¦¾à¦²à¦¾à¦¨à§‹
    card.querySelector(".watchBtn").onclick=()=>{currentIndex=i;playChannel(ch.url,ch.name);};
    
    // Lazy Loading â†’ à¦¯à¦–à¦¨ à¦•à¦¾à¦°à§à¦¡ à¦¸à§à¦•à§à¦°à¦¿à¦¨à§‡ à¦†à¦¸à¦¬à§‡ à¦¤à¦–à¦¨ à¦ªà§à¦°à¦¿à¦­à¦¿à¦‰ à¦šà¦¾à¦²à§ à¦¹à¦¬à§‡
    const observer=new IntersectionObserver(entries=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          const preview=card.querySelector(".preview");
          preview.src=ch.url; // à¦ªà§à¦°à¦¿à¦­à¦¿à¦‰ à¦²à§‹à¦¡ à¦¹à¦¬à§‡
          preview.autoplay=true;
          preview.loop=true;
          observer.unobserve(card);
        }
      });
    });
    observer.observe(card);

    // à¦¯à¦¦à¦¿ à¦­à¦¿à¦¡à¦¿à¦“ à¦²à§‹à¦¡ à¦¨à¦¾ à¦¹à§Ÿ â†’ fallback à¦²à§‹à¦—à§‹
    const preview=card.querySelector(".preview");
    preview.onerror=()=>{ preview.replaceWith(`<img src="${ch.logo}" class="preview">`); };

    grid.appendChild(card);
  });
  document.getElementById("channelCount").textContent=list.length+" CHANNELS";
}

async function init(){
  channels=await loadPlaylist(); 
  renderChannels(channels);
  if(channels.length>0){ playChannel(channels[0].url,channels[0].name); }
}
init();
</script>
</body>
</html>
