<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live TV Pro - Final Edition</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root { --primary:#00e5ff; --bg:#0a0a0a; --card:#1a1a1a; --focus:#00e5ff; --star:#ffd700; --accent:#ff4081; }

body{
  margin:0;font-family:sans-serif;background:var(--bg);color:#eee;
  display:flex;flex-direction:column;min-height:100vh;
}

#player{
  width:100%;background:black;position:sticky;top:0;z-index:1000;
}

.video-container{
  max-width:1000px;margin:0 auto;width:100%;aspect-ratio:16/9;
}

video{
  width:100%;height:100%;display:block;background:black;
}

/* ✅ SAFE FULLSCREEN FIX */
video:fullscreen,
video:-webkit-full-screen{
  width:100vw;
  height:100vh;
  object-fit:contain;
}

header{padding:10px;background:#111;border-bottom:1px solid #222;}
.tabs{display:flex;gap:8px;overflow-x:auto;padding:10px 0;}
.tab-btn{padding:8px 16px;background:#222;border:1px solid #333;color:#ccc;border-radius:20px;}
.tab-btn.active{background:var(--accent);color:#fff;}

#content-area{padding:15px;max-width:1200px;margin:0 auto;width:100%;}
#channelList{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:15px;padding-bottom:120px;}

.channel-card{
  background:var(--card);border-radius:12px;padding:12px;text-align:center;
  cursor:pointer;transition:.3s;border:2px solid transparent;position:relative;
}
.channel-card:hover{border-color:var(--primary);}
.star-icon{position:absolute;top:5px;right:5px;color:var(--star);display:none;}
.is-fav .star-icon{display:block;}
.channel-logo{width:100%;height:60px;object-fit:contain;}
.channel-name{font-size:13px;margin-top:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
</style>
</head>

<body>

<div id="player">
  <div class="video-container">
    <video id="video" controls autoplay playsinline webkit-playsinline></video>
  </div>
</div>

<header>
  <div class="tabs">
    <button class="tab-btn active" onclick="filterCat('all',this)">All</button>
    <button class="tab-btn" onclick="filterCat('fav',this)">★ Favorite</button>
    <button class="tab-btn" onclick="filterCat('bangla',this)">Bangla</button>
    <button class="tab-btn" onclick="filterCat('sports',this)">Sports</button>
  </div>
  <input id="search" placeholder="চ্যানেল খুঁজুন..." style="width:100%;padding:12px;border-radius:30px;background:#222;color:white;border:1px solid #444;">
</header>

<div id="content-area">
  <div id="channelList"></div>
</div>

<script>
const playlistUrl="https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv/main/Live%20tv";
let allChannels=[],favorites=JSON.parse(localStorage.getItem("myFavs"))||[];
let currentCategory="all",hls=null,selectedId=null;
const video=document.getElementById("video");

async function init(){
  const res=await fetch(playlistUrl);
  const data=await res.text();
  allChannels=parseM3U(data);
  render(allChannels);
  if(allChannels.length) playFromUrl(allChannels[0].url);
}

function parseM3U(data){
  const lines=data.split("\n"),list=[];
  let cur={};
  lines.forEach(l=>{
    l=l.trim();
    if(l.startsWith("#EXTINF")){
      cur.name=l.split(",")[1]||"Unknown";
      cur.logo=l.match(/tvg-logo="([^"]+)"/)?.[1]||"";
      cur.cat=(l.match(/group-title="([^"]+)"/)?.[1]||"").toLowerCase();
      cur.id=btoa(unescape(encodeURIComponent(cur.name)));
    }else if(l.startsWith("http")){
      cur.url=l;list.push({...cur});cur={};
    }
  });
  return list;
}

function render(list){
  channelList.innerHTML=list.map(ch=>{
    const fav=favorites.includes(ch.id);
    return `
    <div class="channel-card ${fav?'is-fav':''}"
      onclick="playFromUrl('${ch.url}')"
      oncontextmenu="toggleFav('${ch.id}');return false;">
      <span class="star-icon">★</span>
      <img src="${ch.logo}" class="channel-logo">
      <div class="channel-name">${ch.name}</div>
    </div>`;
  }).join("");
}

function playFromUrl(url){
  if(hls) hls.destroy();
  if(Hls.isSupported()){
    hls=new Hls();hls.loadSource(url);hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
  }else{
    video.src=url;video.play();
  }
}

function toggleFav(id){
  favorites=favorites.includes(id)?favorites.filter(f=>f!==id):[...favorites,id];
  localStorage.setItem("myFavs",JSON.stringify(favorites));
  filterCat(currentCategory,document.querySelector(".tab-btn.active"));
}

function filterCat(cat,btn){
  currentCategory=cat;
  document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  let list=cat==="all"?allChannels:cat==="fav"?allChannels.filter(c=>favorites.includes(c.id)):allChannels.filter(c=>c.cat.includes(cat));
  render(list);
}

search.oninput=e=>{
  const q=e.target.value.toLowerCase();
  render(allChannels.filter(c=>c.name.toLowerCase().includes(q)));
};

init();
</script>

</body>
</html>
